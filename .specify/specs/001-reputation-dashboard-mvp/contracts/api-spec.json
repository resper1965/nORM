{
  "openapi": "3.0.3",
  "info": {
    "title": "nORM API",
    "version": "1.0.0",
    "description": "API for nORM - Online Reputation Management System MVP",
    "contact": {
      "name": "nORM Team"
    }
  },
  "servers": [
    {
      "url": "https://norm.vercel.app/api",
      "description": "Production"
    },
    {
      "url": "http://localhost:3000/api",
      "description": "Local Development"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "Error": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string"
          },
          "message": {
            "type": "string"
          }
        }
      },
      "Client": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "name": {
            "type": "string"
          },
          "industry": {
            "type": "string"
          },
          "website": {
            "type": "string",
            "format": "uri"
          },
          "is_active": {
            "type": "boolean"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "ReputationScore": {
        "type": "object",
        "properties": {
          "score": {
            "type": "number",
            "minimum": 0,
            "maximum": 100
          },
          "breakdown": {
            "type": "object",
            "properties": {
              "serp": {
                "type": "number"
              },
              "news": {
                "type": "number"
              },
              "social": {
                "type": "number"
              },
              "trend": {
                "type": "number"
              },
              "volume": {
                "type": "number"
              }
            }
          },
          "trend": {
            "type": "string",
            "enum": ["up", "down", "stable"]
          },
          "change": {
            "type": "number"
          },
          "calculated_at": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "SERPResult": {
        "type": "object",
        "properties": {
          "keyword": {
            "type": "string"
          },
          "position": {
            "type": "integer",
            "nullable": true
          },
          "url": {
            "type": "string"
          },
          "title": {
            "type": "string"
          },
          "snippet": {
            "type": "string"
          },
          "checked_at": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "SocialMention": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "platform": {
            "type": "string",
            "enum": ["instagram", "linkedin", "facebook"]
          },
          "author_name": {
            "type": "string"
          },
          "content": {
            "type": "string"
          },
          "sentiment": {
            "type": "string",
            "enum": ["positive", "neutral", "negative"]
          },
          "sentiment_score": {
            "type": "number",
            "minimum": -1,
            "maximum": 1
          },
          "published_at": {
            "type": "string",
            "format": "date-time"
          },
          "engagement": {
            "type": "object",
            "properties": {
              "likes": {
                "type": "integer"
              },
              "comments": {
                "type": "integer"
              },
              "shares": {
                "type": "integer"
              }
            }
          }
        }
      },
      "GeneratedContent": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "title": {
            "type": "string"
          },
          "content": {
            "type": "string"
          },
          "seo_score": {
            "type": "integer",
            "minimum": 0,
            "maximum": 100
          },
          "status": {
            "type": "string",
            "enum": ["draft", "published", "archived"]
          },
          "generated_at": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "Alert": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "alert_type": {
            "type": "string",
            "enum": ["negative_mention", "score_drop", "serp_change", "social_negative", "critical"]
          },
          "severity": {
            "type": "string",
            "enum": ["low", "medium", "high", "critical"]
          },
          "title": {
            "type": "string"
          },
          "message": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": ["active", "acknowledged", "resolved", "dismissed"]
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "GenerateContentRequest": {
        "type": "object",
        "required": ["client_id", "topic"],
        "properties": {
          "client_id": {
            "type": "string",
            "format": "uuid"
          },
          "topic": {
            "type": "string"
          },
          "article_count": {
            "type": "integer",
            "minimum": 1,
            "maximum": 5,
            "default": 3
          },
          "trigger_mention_id": {
            "type": "string",
            "format": "uuid"
          }
        }
      },
      "GenerateContentResponse": {
        "type": "object",
        "properties": {
          "articles": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/GeneratedContent"
            }
          },
          "generation_time_ms": {
            "type": "integer"
          }
        }
      }
    }
  },
  "paths": {
    "/health": {
      "get": {
        "summary": "Health check",
        "operationId": "healthCheck",
        "tags": ["System"],
        "responses": {
          "200": {
            "description": "Service is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "ok"
                    },
                    "timestamp": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/clients": {
      "get": {
        "summary": "List clients",
        "operationId": "listClients",
        "tags": ["Clients"],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of clients",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "clients": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Client"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/clients/{clientId}/reputation": {
      "get": {
        "summary": "Get client reputation score",
        "operationId": "getReputation",
        "tags": ["Reputation"],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "clientId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Reputation score",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReputationScore"
                }
              }
            }
          },
          "404": {
            "description": "Client not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/clients/{clientId}/serp": {
      "get": {
        "summary": "Get SERP positions for client keywords",
        "operationId": "getSERPPositions",
        "tags": ["SERP"],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "clientId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          },
          {
            "name": "keyword_id",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Filter by keyword ID"
          }
        ],
        "responses": {
          "200": {
            "description": "SERP positions",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "results": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/SERPResult"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/social/mentions": {
      "get": {
        "summary": "Get aggregated social media mentions",
        "operationId": "getSocialMentions",
        "tags": ["Social"],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "client_id",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Filter by client ID"
          },
          {
            "name": "platform",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["instagram", "linkedin", "facebook"]
            },
            "description": "Filter by platform"
          },
          {
            "name": "sentiment",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["positive", "neutral", "negative"]
            },
            "description": "Filter by sentiment"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 50,
              "maximum": 100
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Social mentions",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "mentions": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/SocialMention"
                      }
                    },
                    "total": {
                      "type": "integer"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/generate-content": {
      "post": {
        "summary": "Generate AI content articles",
        "operationId": "generateContent",
        "tags": ["Content"],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GenerateContentRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Generated articles",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GenerateContentResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "429": {
            "description": "Rate limit exceeded",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/wordpress/publish": {
      "post": {
        "summary": "Publish article to WordPress as draft",
        "operationId": "publishToWordPress",
        "tags": ["WordPress"],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["content_id", "wordpress_site_id"],
                "properties": {
                  "content_id": {
                    "type": "string",
                    "format": "uuid"
                  },
                  "wordpress_site_id": {
                    "type": "string",
                    "format": "uuid"
                  },
                  "category": {
                    "type": "string"
                  },
                  "tags": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Article published",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "wordpress_post_id": {
                      "type": "integer"
                    },
                    "wordpress_url": {
                      "type": "string",
                      "format": "uri"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request or WordPress connection failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/alerts": {
      "get": {
        "summary": "Get active alerts",
        "operationId": "getAlerts",
        "tags": ["Alerts"],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "client_id",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["active", "acknowledged", "resolved", "dismissed"]
            }
          },
          {
            "name": "severity",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["low", "medium", "high", "critical"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of alerts",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "alerts": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Alert"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/cron/scrape-news": {
      "post": {
        "summary": "Trigger news scraping (cron job)",
        "operationId": "scrapeNews",
        "tags": ["Cron"],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "News scraping started",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "started"
                    },
                    "clients_processed": {
                      "type": "integer"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/cron/sync-social": {
      "post": {
        "summary": "Trigger social media sync (cron job)",
        "operationId": "syncSocial",
        "tags": ["Cron"],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Social sync started",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "started"
                    },
                    "accounts_synced": {
                      "type": "integer"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/cron/calculate-reputation": {
      "post": {
        "summary": "Recalculate reputation scores (cron job)",
        "operationId": "calculateReputation",
        "tags": ["Cron"],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Reputation calculation started",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "started"
                    },
                    "clients_processed": {
                      "type": "integer"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}

