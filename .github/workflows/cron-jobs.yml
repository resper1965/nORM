name: Scheduled Cron Jobs (Free Alternative to Vercel Crons)

on:
  schedule:
    # Calculate reputation - Daily at midnight UTC
    - cron: '0 0 * * *'
    # Sync social media - Every 6 hours
    - cron: '0 */6 * * *'
    # Check SERP positions - Every 6 hours
    - cron: '30 */6 * * *'
    # Scrape news - Daily at 8am UTC
    - cron: '0 8 * * *'
    # Send alerts - Every 15 minutes
    - cron: '*/15 * * * *'
  
  # Allow manual trigger
  workflow_dispatch:
    inputs:
      job:
        description: 'Job to run (all, reputation, social, serp, news, alerts)'
        required: false
        default: 'all'

jobs:
  calculate-reputation:
    name: Calculate Reputation Scores
    runs-on: ubuntu-latest
    if: |
      github.event.schedule == '0 0 * * *' || 
      github.event.inputs.job == 'all' || 
      github.event.inputs.job == 'reputation'
    steps:
      - name: Call API endpoint
        run: |
          curl -X POST ${{ secrets.APP_URL }}/api/cron/calculate-reputation \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json"

  sync-social:
    name: Sync Social Media
    runs-on: ubuntu-latest
    if: |
      github.event.schedule == '0 */6 * * *' || 
      github.event.inputs.job == 'all' || 
      github.event.inputs.job == 'social'
    steps:
      - name: Call API endpoint
        run: |
          curl -X POST ${{ secrets.APP_URL }}/api/cron/sync-social \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json"

  check-serp:
    name: Check SERP Positions
    runs-on: ubuntu-latest
    if: |
      github.event.schedule == '30 */6 * * *' || 
      github.event.inputs.job == 'all' || 
      github.event.inputs.job == 'serp'
    steps:
      - name: Call API endpoint
        run: |
          curl -X POST ${{ secrets.APP_URL }}/api/cron/check-serp \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json"

  scrape-news:
    name: Scrape News
    runs-on: ubuntu-latest
    if: |
      github.event.schedule == '0 8 * * *' || 
      github.event.inputs.job == 'all' || 
      github.event.inputs.job == 'news'
    steps:
      - name: Call API endpoint
        run: |
          curl -X POST ${{ secrets.APP_URL }}/api/cron/scrape-news \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json"

  send-alerts:
    name: Send Alerts
    runs-on: ubuntu-latest
    if: |
      github.event.schedule == '*/15 * * * *' || 
      github.event.inputs.job == 'all' || 
      github.event.inputs.job == 'alerts'
    steps:
      - name: Call API endpoint
        run: |
          curl -X POST ${{ secrets.APP_URL }}/api/cron/send-alerts \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json"

  # Auto-generate-content removed - content generation is triggered manually via UI
